{% extends "base.html" %}
{% load static %}
{% load grupo_tags %}

{% block css %}
<!-- Select Plugin CSS -->
    <link rel="stylesheet" href="{% static 'plugins/select2/select2.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/select2/select2-bootstrap4.css' %}">

    <link href="{% static 'plugins/sweetalert2/sweetalert2.min.css' %}" rel="stylesheet" type="text/css">

{% endblock %}

{% block title %}Centro{% endblock %}

{% block content %}

    <div class="container-fluid">
        <div class="page-title-head d-flex align-items-center">
            <div class="flex-grow-1">
                <h4 class="fs-sm text-uppercase fw-bold m-0">Horarios</h4>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card" data-table>
                    <div class="card-header border-light justify-content-between">
                        <h4 class="card-title">Copiar horario profesorado</h4>
                    </div>

                    <div class="card-body">
                        <form method="post" id="importarHorarioForm">
                            {% csrf_token %}

                            <div class="row g-2">
                                <div class="mb-3 col-md-6">
                                    <label for="id_ProfesorOrigen" class="form-label">Seleccionar profesor origen</label>
                                    {{ form.ProfesorOrigen }}
                                </div>
                                <div class="mb-3 col-md-6">
                                    <label for="id_ProfesorDestino" class="form-label">Seleccionar profesor destino</label>
                                    {{ form.ProfesorDestino }}
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary" id="btnCopiarHorario">
                                Copiar horario completo
                            </button>
                        </form>
                    </div>

                    <div class="card-footer border-0"></div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block js %}
        <!-- Sweet Alerts js -->
    <script src="{% static 'plugins/sweetalert2/sweetalert2.min.js' %}"></script>

    <!-- Select2 Plugin Js -->
    <script src="{% static 'plugins/select2/select2.min.js' %}"></script>

    <script>
        $(document).ready(function () {
            // Inicializar Select2 (usa las clases que traen tus widgets)
            $(".select2_ProfesorOrigen").select2({ theme: 'bootstrap4', placeholder: "Profesor origen", allowClear: true });
            $(".select2_ProfesorDestino").select2({ theme: 'bootstrap4', placeholder: "Profesor destino", allowClear: true });

            // Confirmación antes de enviar
            $("#btnCopiarHorario").on("click", function (event) {
                event.preventDefault();

                Swal.fire({
                    title: "¿Estás seguro?",
                    text: "Se copiará el horario del profesor origen al destino.",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Sí, copiar horario",
                    cancelButtonText: "Cancelar"
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Evitar doble envío
                        const btn = $("#btnCopiarHorario");
                        btn.prop('disabled', true).text('Procesando...');
                        $("#importarHorarioForm")[0].submit();
                    }
                });
            });

            // Evitar submit con Enter en inputs/selects
            $('form').on('keypress', 'input, select', function (e) {
                if (e.which === 13) {
                    e.preventDefault();
                }
            });
        });
    </script>
{% endblock %}
